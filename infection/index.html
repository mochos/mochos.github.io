<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa del Overworld</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="shortcut icon" href="mapa-recursos/icon.png"/>
    <style>
        body {margin: 0;}
        #map {
            height: 100vh; width: 100vw;
        }
        img {image-rendering: pixelated;}
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        var map = L.map('map', {
            crs: L.CRS.Simple,
            minZoom: 4,
            maxZoom: 12
        });

        // Obtener los argumentos de la URL
        var urlParams = new URLSearchParams(window.location.search);
        var showCoordinates = urlParams.get('coords');
        var x = parseFloat(urlParams.get('x')) || 5.7;  // Valor predeterminado si no se proporciona
        var y = parseFloat(urlParams.get('y')) || 0.6;  // Valor predeterminado si no se proporciona
        var z = parseInt(urlParams.get('z')) || 8;      // Valor predeterminado si no se proporciona

        // Carpeta que contiene las imágenes
        var imagePath = 'https://raw.githubusercontent.com/lorspi/Infection/main/overworld/day/';

        // Dimensiones de cada imagen
        var imageSize = 1;

        // Tamaño total de la matriz de imágenes
        var matrixSize = 20;

        // Centrar el mapa en la posición proporcionada
        var centerCoords = [0, 0];
        var coordenadaInicial = [x, y];

        var imageUrl = imagePath + '0,0.png';
        var imageBounds = [centerCoords, [centerCoords[0] + imageSize, centerCoords[1] + imageSize]];

        L.imageOverlay(imageUrl, imageBounds).addTo(map);

        // Función para cargar las imágenes y agregarlas al mapa
        function loadImages() {
            for (var i = -matrixSize; i <= matrixSize; i++) {
                for (var j = -matrixSize; j <= matrixSize; j++) {
                    if (i === 0 && j === 0) {
                        continue; // Saltar la imagen central
                    }

                    var imageX = centerCoords[0] + i * imageSize;
                    var imageY = centerCoords[1] + j * imageSize;
                    var imageXinv = -imageX

                    var imageUrl = imagePath + imageY + ',' + imageXinv + '.png';
                    var imageBounds = [[imageX, imageY], [imageX + imageSize, imageY + imageSize]];

                    L.imageOverlay(imageUrl, imageBounds).addTo(map);
                }
            }
        }

        // Llama a la función para cargar las imágenes
        loadImages();

        // Crea un ícono personalizado
        var marcadorAzul = L.icon({
            iconUrl: 'mapa-recursos/marcador-azul.png',
            iconSize: [32, 32],
            iconAnchor: [16, 16],
            popupAnchor: [0, 0]
        });
        var marcadorAmarillo = L.icon({
            iconUrl: 'mapa-recursos/marcador-amarillo.png',
            iconSize: [32, 32],
            iconAnchor: [16, 16],
            popupAnchor: [0, 0]
        });
        var marcadorMorado = L.icon({
            iconUrl: 'mapa-recursos/marcador-morado.png',
            iconSize: [32, 32],
            iconAnchor: [16, 16],
            popupAnchor: [0, 0]
        });

        // Agrega marcadores u otras capas aquí si es necesario
        L.marker([5.7, 0.6], { icon: marcadorAzul }).addTo(map)
            .bindPopup('Casita');
        //---
        L.marker([0, 19.2], { icon: marcadorAmarillo }).addTo(map)
            .bindPopup('Ancient');
        L.marker([17.3, 18.7], { icon: marcadorAmarillo }).addTo(map)
            .bindPopup('Champivacas');
        L.marker([-11.6, 2.35], { icon: marcadorAmarillo }).addTo(map)
            .bindPopup('Helado');
        L.marker([3.85, -5], { icon: marcadorAmarillo }).addTo(map)
            .bindPopup('Lush');
        L.marker([-13.28, 2.79], { icon: marcadorAmarillo }).addTo(map)
            .bindPopup('AldeaFría');
        L.marker([-11.49, -6.96], { icon: marcadorAmarillo }).addTo(map)
            .bindPopup('AldeaFría-2');
        L.marker([20.21, 7.92], { icon: marcadorAmarillo }).addTo(map)
            .bindPopup('Ancient-2');
        L.marker([-2.04, 7.67], { icon: marcadorAmarillo }).addTo(map)
            .bindPopup('Ancient-3');
        L.marker([7.34, 2.90], { icon: marcadorAmarillo }).addTo(map)
            .bindPopup('AldeanosDesierto');
        //---
        L.marker([20.45, -18.78], { icon: marcadorMorado }).addTo(map)
            .bindPopup('Aldeanos');
        L.marker([-9.54, 18.69], { icon: marcadorMorado }).addTo(map)
            .bindPopup('Withers');
        L.marker([-3.25, 8.11], { icon: marcadorMorado }).addTo(map)
            .bindPopup('Arqueología');
        L.marker([-8.07, -7.52], { icon: marcadorMorado }).addTo(map)
            .bindPopup('Base escondida');

        // Agrega un control de clic al mapa solo si se proporciona el argumento en la URL
        if (showCoordinates === 'true') {
            map.on('click', function(e) {
                var coordinates = e.latlng;
                var lat = coordinates.lat.toFixed(2);
                var lng = coordinates.lng.toFixed(2);

                // Crea un enlace que lleva a las coordenadas en la URL
                var link = '<a href="?x=' + lat + '&y=' + lng + '&z=' + map.getZoom() + '">Ir a estas coordenadas</a>';

                L.popup()
                    .setLatLng(coordinates)
                    .setContent("Coordenadas: " + lat + ", " + lng + "<br>" + link)
                    .openOn(map);
            });
        }
        // Centra el mapa y establece el nivel de zoom
        map.setView(coordenadaInicial, z);
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var images = document.getElementsByTagName('img');

            for (var i = 0; i < images.length; i++) {
                images[i].addEventListener('error', function() {
                    // Aplica estilos a las imágenes que no se han cargado
                    this.style.opacity = '0';
                });
            }
        });
    </script>
    <script async data-id="101432442" src="//static.getclicky.com/js"></script>
</body>
</html>
